/*
 * Facebook fby4
 *
 * Copyright 2016 IBM Corp.
 *
 * SPDX-License-Identifier: GPL-2.0-or-later
 */

#include "qemu/osdep.h"
#include "qapi/error.h"
#include "hw/arm/machines-qom.h"
#include "hw/arm/aspeed.h"
#include "hw/arm/aspeed_soc.h"
#include "hw/nvram/eeprom_at24c.h"
#include "hw/sensor/tmp105.h"
#include "system/reset.h"

#define TYPE_LM75 TYPE_TMP105
#define TYPE_TMP421 "tmp421"
#define FBY4_BMC_RAM_SIZE ASPEED_RAM_SIZE(2 * GiB)

static const uint8_t fby35_nic_fruid[] = {
    0x01, 0x00, 0x00, 0x01, 0x0f, 0x20, 0x00, 0xcf, 0x01, 0x0e, 0x19, 0xd7,
    0x5e, 0xcf, 0xc8, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xdd,
    0x4d, 0x65, 0x6c, 0x6c, 0x61, 0x6e, 0x6f, 0x78, 0x20, 0x43, 0x6f, 0x6e,
    0x6e, 0x65, 0x63, 0x74, 0x58, 0x2d, 0x36, 0x20, 0x44, 0x58, 0x20, 0x4f,
    0x43, 0x50, 0x33, 0x2e, 0x30, 0xd8, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xd5, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0xcc, 0x46, 0x52, 0x55, 0x20, 0x56, 0x65, 0x72,
    0x20, 0x30, 0x2e, 0x30, 0x32, 0xc0, 0xc0, 0xc0, 0xc1, 0x00, 0x00, 0x2f,
    0x01, 0x11, 0x19, 0xc8, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0xdd, 0x4d, 0x65, 0x6c, 0x6c, 0x61, 0x6e, 0x6f, 0x78, 0x20, 0x43, 0x6f,
    0x6e, 0x6e, 0x65, 0x63, 0x74, 0x58, 0x2d, 0x36, 0x20, 0x44, 0x58, 0x20,
    0x4f, 0x43, 0x50, 0x33, 0x2e, 0x30, 0xd5, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0xd3, 0x41, 0x39, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0xd8, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0xc0, 0xc0, 0xc0, 0xc0, 0xcd, 0x43, 0x6f, 0x6e, 0x6e, 0x65, 0x63,
    0x74, 0x58, 0x2d, 0x36, 0x20, 0x44, 0x58, 0xc1, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xdb, 0xc0, 0x82, 0x30, 0x15, 0x79, 0x7f, 0xa6, 0x00,
    0x01, 0x18, 0x0b, 0xff, 0x08, 0x00, 0xff, 0xff, 0x64, 0x00, 0x00, 0x00,
    0x00, 0x03, 0x20, 0x01, 0xff, 0xff, 0x04, 0x46, 0x00, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0x01, 0x81, 0x09, 0x15, 0xb3, 0x10, 0x1d, 0x00,
    0x24, 0x15, 0xb3, 0x00, 0x02, 0xeb, 0x8a, 0x95, 0x5c,
};
static const size_t fby35_nic_fruid_len = sizeof(fby35_nic_fruid);

static const uint8_t fby35_bb_fruid[] = {
    0x01, 0x00, 0x01, 0x03, 0x10, 0x00, 0x00, 0xeb, 0x01, 0x02, 0x17, 0xc3,
    0x4e, 0x2f, 0x41, 0xc3, 0x4e, 0x2f, 0x41, 0xc1, 0x00, 0x00, 0x00, 0x23,
    0x01, 0x0d, 0x00, 0xb6, 0xd2, 0xd0, 0xc6, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0xd5, 0x4d, 0x61, 0x6e, 0x61, 0x67, 0x65, 0x6d, 0x65, 0x6e, 0x74,
    0x20, 0x42, 0x6f, 0x61, 0x72, 0x64, 0x20, 0x77, 0x42, 0x4d, 0x43, 0xcd,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0xce, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0xc3, 0x31, 0x2e, 0x30, 0xc9, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xd2, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x01, 0x0c, 0x00, 0xc6,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xd2, 0x59, 0x6f, 0x73, 0x65, 0x6d,
    0x69, 0x74, 0x65, 0x20, 0x56, 0x33, 0x2e, 0x35, 0x20, 0x45, 0x56, 0x54,
    0x32, 0xce, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0xc4, 0x45, 0x56, 0x54, 0x32, 0xcd, 0x58, 0x58,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xc7,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xc3, 0x31, 0x2e, 0x30, 0xc9,
    0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0x58, 0xc3, 0x4e, 0x2f,
    0x41, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43,
};
static const size_t fby35_bb_fruid_len = sizeof(fby35_bb_fruid);

/* Yosemite4 Sentinel Dome BMC Management Board */
static const uint8_t fby4_bmc_storage_module[] = {
  0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xfe, 0x01, 0x09, 0x19, 0xaf,
  0x19, 0xe5, 0xc6, 0x57, 0x69, 0x77, 0x79, 0x6e, 0x6e, 0xd2, 0x42, 0x4d,
  0x43, 0x20, 0x53, 0x74, 0x6f, 0x72, 0x61, 0x67, 0x65, 0x20, 0x4d, 0x6f,
  0x64, 0x75, 0x6c, 0x65, 0x89, 0x68, 0x18, 0x9a, 0x91, 0xd8, 0x42, 0x96,
  0x65, 0x95, 0x89, 0x38, 0x8e, 0x37, 0x38, 0x8e, 0x37, 0x38, 0x8e, 0x03,
  0xc0, 0x89, 0x38, 0x29, 0x97, 0x91, 0x18, 0x45, 0x51, 0x14, 0x95, 0xc1,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xab
};
static const size_t fby4_bmc_storage_module_len = sizeof(fby4_bmc_storage_module);

/* Yosemite4 Sentinel Dome without Retimer Boards */
static const uint8_t fby4_sentinel_dome_board_fruid[] = {
      0x01, 0x00, 0x00, 0x01, 0x09, 0x00, 0x00, 0xf5, 0x01, 0x08, 0x19, 0xd2,
      0x4f, 0xf0, 0xc6, 0x51, 0x75, 0x61, 0x6e, 0x74, 0x61, 0xdd, 0x53, 0x65,
      0x6e, 0x74, 0x69, 0x6e, 0x65, 0x6c, 0x20, 0x44, 0x6f, 0x6d, 0x65, 0x20,
      0x77, 0x69, 0x74, 0x68, 0x6f, 0x75, 0x74, 0x20, 0x52, 0x65, 0x74, 0x69,
      0x6d, 0x65, 0x72, 0x87, 0x38, 0x8e, 0xe3, 0x0d, 0x8e, 0xe3, 0x38, 0x86,
      0x38, 0x8e, 0x37, 0x38, 0x8e, 0x03, 0xc0, 0xc1, 0x00, 0x00, 0x00, 0xfa,
      0x01, 0x09, 0x19, 0xc6, 0x51, 0x75, 0x61, 0x6e, 0x74, 0x61, 0xcb, 0x59,
      0x6f, 0x73, 0x65, 0x6d, 0x69, 0x74, 0x65, 0x20, 0x56, 0x34, 0x86, 0x38,
      0x8e, 0x37, 0x38, 0x8e, 0x03, 0xc4, 0x76, 0x31, 0x2e, 0x31, 0x87, 0x38,
      0x8e, 0xe3, 0x0d, 0x8e, 0xe3, 0x38, 0xc0, 0xc0, 0xc7, 0x55, 0x6e, 0x6b,
      0x6e, 0x6f, 0x77, 0x6e, 0xce, 0x59, 0x6f, 0x73, 0x65, 0x6d, 0x69, 0x74,
      0x65, 0x20, 0x56, 0x34, 0x20, 0x54, 0x31, 0xc1, 0x00, 0x00, 0x00, 0x89
};
static const size_t fby4_sentinel_dome_board_fruid_len = sizeof(fby4_sentinel_dome_board_fruid);

/* Yosemite 4 Sentinel Dome Chassis FRU */
static const uint8_t fby4_sentinel_dome_chassis_fruid[] = {
    0x01, 0x00, 0x00, 0x01, 0x07, 0x00, 0x00, 0xf7, 0x01, 0x06, 0x19, 0x94,
    0x4f, 0xf0, 0xc6, 0x51, 0x75, 0x61, 0x6e, 0x74, 0x61, 0xcd, 0x53, 0x65,
    0x6e, 0x74, 0x69, 0x6e, 0x65, 0x6c, 0x20, 0x44, 0x6f, 0x6d, 0x65, 0x87,
    0x38, 0x8e, 0xe3, 0x0d, 0x8e, 0xe3, 0x38, 0x86, 0x38, 0x8e, 0x37, 0x38,
    0x8e, 0x03, 0xc0, 0xc1, 0x00, 0x00, 0x00, 0x76, 0x01, 0x06, 0x19, 0xc6,
    0x51, 0x75, 0x61, 0x6e, 0x74, 0x61, 0xcb, 0x59, 0x6f, 0x73, 0x65, 0x6d,
    0x69, 0x74, 0x65, 0x20, 0x56, 0x34, 0x86, 0x38, 0x8e, 0x37, 0x38, 0x8e,
    0x03, 0xc4, 0x76, 0x31, 0x2e, 0x31, 0x87, 0x38, 0x8e, 0xe3, 0x0d, 0x8e,
    0xe3, 0x38, 0xc0, 0xc0, 0xc1, 0x00, 0x00, 0xaf
};
static const size_t fby4_sentinel_dome_chassis_fruid_len = sizeof(fby4_sentinel_dome_chassis_fruid);

// /* Yosemite 4 Sentinel Dome Enclosure FRU */
static const uint8_t fby4_sentinel_dome_enclosure_fruid[] = {
    0x01, 0x00, 0x00, 0x01, 0x08, 0x00, 0x00, 0xf6, 0x01, 0x07, 0x19, 0xe0,
    0x4f, 0xf0, 0xc6, 0x51, 0x75, 0x61, 0x6e, 0x74, 0x61, 0xd5, 0x4d, 0x61,
    0x6e, 0x61, 0x67, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x42, 0x6f, 0x61,
    0x72, 0x64, 0x20, 0x77, 0x42, 0x4d, 0x43, 0x87, 0x38, 0x8e, 0xe3, 0x0d,
    0x8e, 0xe3, 0x38, 0x86, 0x38, 0x8e, 0x37, 0x38, 0x8e, 0x03, 0xc0, 0xc1,
    0x00, 0x00, 0x00, 0x9a, 0x01, 0x06, 0x19, 0xc6, 0x51, 0x75, 0x61, 0x6e,
    0x74, 0x61, 0xcb, 0x59, 0x6f, 0x73, 0x65, 0x6d, 0x69, 0x74, 0x65, 0x20,
    0x56, 0x34, 0x86, 0x38, 0x8e, 0x37, 0x38, 0x8e, 0x03, 0xc4, 0x76, 0x31,
    0x2e, 0x31, 0x87, 0x38, 0x8e, 0xe3, 0x0d, 0x8e, 0xe3, 0x38, 0xc0, 0xc0,
    0xc1, 0x00, 0x00, 0xaf
};
static const size_t fby4_sentinel_dome_enclosure_fruid_len = sizeof(fby4_sentinel_dome_enclosure_fruid);

/* Yosemite 4 FanBoards FRU */
static const uint8_t fby4_fanboard_fsc_max_adc_ti_led_ons_efuse_max[] = {
    0x01, 0x00, 0x00, 0x01, 0x08, 0x00, 0x00, 0xf6, 0x01, 0x07, 0x19,
    0x54, 0x04, 0xee, 0xc0, 0xea, 0x46, 0x61, 0x6e, 0x20, 0x42, 0x6f,
    0x61, 0x72, 0x64, 0x20, 0x46, 0x53, 0x43, 0x2d, 0x4d, 0x41, 0x58,
    0x20, 0x41, 0x44, 0x43, 0x2d, 0x54, 0x49, 0x20, 0x4c, 0x45, 0x44,
    0x2d, 0x4f, 0x4e, 0x53, 0x20, 0x45, 0x46, 0x55, 0x53, 0x45, 0x2d,
    0x4d, 0x41, 0x58, 0xc0, 0xc0, 0xc0, 0xc1, 0x00, 0x53, 0x01, 0x03,
    0x19, 0xc0, 0xcb, 0x59, 0x6f, 0x73, 0x65, 0x6d, 0x69, 0x74, 0x65,
    0x20, 0x56, 0x34, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc1, 0x00, 0xde};
static const size_t fby4_fanboard_fsc_max_adc_ti_led_ons_efuse_max_len = sizeof(fby4_fanboard_fsc_max_adc_ti_led_ons_efuse_max);

static const uint8_t fby4_fanboard_fsc_max_adc_ti_led_nxp_efuse_max[] = {
    0x01, 0x00, 0x00, 0x01, 0x08, 0x00, 0x00, 0xf6, 0x01, 0x07, 0x19,
    0x4a, 0x03, 0xee, 0xc0, 0xea, 0x46, 0x61, 0x6e, 0x20, 0x42, 0x6f,
    0x61, 0x72, 0x64, 0x20, 0x46, 0x53, 0x43, 0x2d, 0x4d, 0x41, 0x58,
    0x20, 0x41, 0x44, 0x43, 0x2d, 0x54, 0x49, 0x20, 0x4c, 0x45, 0x44,
    0x2d, 0x4e, 0x58, 0x50, 0x20, 0x45, 0x46, 0x55, 0x53, 0x45, 0x2d,
    0x4d, 0x41, 0x58, 0xc0, 0xc0, 0xc0, 0xc1, 0x00, 0x58, 0x01, 0x03,
    0x19, 0xc0, 0xcb, 0x59, 0x6f, 0x73, 0x65, 0x6d, 0x69, 0x74, 0x65,
    0x20, 0x56, 0x34, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc1, 0x00, 0xde};

static const size_t fby4_fanboard_fsc_max_adc_ti_led_nxp_efuse_max_len = sizeof(fby4_fanboard_fsc_max_adc_ti_led_nxp_efuse_max);

static void fby4_i2c_init(AspeedMachineState *bmc) {
  AspeedSoCState *soc = bmc->soc;
  I2CBus *i2c[16];
  I2CSlave *fan_mux;

  for (int i = 0; i < 16; i++) {
    i2c[i] = aspeed_i2c_get_bus(&soc->i2c, i);
  }

  i2c_slave_create_simple(i2c[2], TYPE_LM75, 0x4f);
  i2c_slave_create_simple(i2c[8], TYPE_TMP421, 0x1f);
  /* Hotswap controller is actually supposed to be mp5920 or ltc4282. */
  i2c_slave_create_simple(i2c[11], "adm1272", 0x44);

  i2c_slave_create_simple(i2c[12], TYPE_LM75, 0x4e);
  i2c_slave_create_simple(i2c[12], TYPE_LM75, 0x4f);

  // Yosemite4 fanboard connection
  fan_mux = i2c_slave_create_simple(i2c[14], TYPE_PCA9546, 0x74);

  at24c_eeprom_init(i2c[4], 0x51, 128 * KiB);
  at24c_eeprom_init(i2c[6], 0x51, 128 * KiB);
  at24c_eeprom_init_rom(i2c[8], 0x50, 32 * KiB, fby35_nic_fruid,
                        fby35_nic_fruid_len);
  at24c_eeprom_init_rom(i2c[11], 0x51, 128 * KiB, fby35_bb_fruid,
                        fby35_bb_fruid_len);
  at24c_eeprom_init_rom(i2c[11], 0x54, 128 * KiB, fby35_bmc_fruid,
                        fby35_bmc_fruid_len);

  /* Sentinel Dome Board EEPROMS */
  const uint8_t enclosure_addr = 0x51;
  const uint8_t board_addr = 0x54;
  const uint8_t chassis_addr = 0x55;

  // Enclosure
  at24c_eeprom_init_rom(i2c[1], enclosure_addr, 128 * KiB,
                        fby4_sentinel_dome_enclosure_fruid,
                        fby4_sentinel_dome_enclosure_fruid_len);

  // Board
  at24c_eeprom_init_rom(i2c[1], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[2], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[3], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[4], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[5], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[6], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[7], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  at24c_eeprom_init_rom(i2c[8], board_addr, 128 * KiB,
                        fby4_sentinel_dome_board_fruid,
                        fby4_sentinel_dome_board_fruid_len);
  // Chassis
  at24c_eeprom_init_rom(i2c[1], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[2], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[3], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[4], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[5], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[6], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[7], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);
  at24c_eeprom_init_rom(i2c[8], chassis_addr, 128 * KiB,
                        fby4_sentinel_dome_chassis_fruid,
                        fby4_sentinel_dome_chassis_fruid_len);

  // Fanboards
  at24c_eeprom_init_rom(pca954x_i2c_get_bus(fan_mux, 0), 0x52, 128 * KiB,
                        fby4_fanboard_fsc_max_adc_ti_led_ons_efuse_max,
                        fby4_fanboard_fsc_max_adc_ti_led_ons_efuse_max_len);
  at24c_eeprom_init_rom(pca954x_i2c_get_bus(fan_mux, 1), 0x52, 128 * KiB,
                        fby4_fanboard_fsc_max_adc_ti_led_nxp_efuse_max,
                        fby4_fanboard_fsc_max_adc_ti_led_nxp_efuse_max_len);
  /*
   * TODO: There is a multi-master i2c connection to an AST1030 MiniBMC on
   * buses 0, 1, 2, 3, and 9. Source address 0x10, target address 0x20 on
   * each.
   */
}

static void fby4_reset(MachineState *state, ResetType type) {
  AspeedMachineState *bmc = ASPEED_MACHINE(state);
  AspeedGPIOState *gpio = &bmc->soc->gpio;

  qemu_devices_reset(type);

  /* Board ID: 7 (Class-1, 4 slots) */
  object_property_set_bool(OBJECT(gpio), "gpioV4", true, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioV5", true, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioV6", true, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioV7", false, &error_fatal);

  /* Slot presence pins, inverse polarity. (False means present) */
  object_property_set_bool(OBJECT(gpio), "gpioH4", false, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioH5", true, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioH6", true, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioH7", true, &error_fatal);

  /* Slot 12v power pins, normal polarity. (True means powered-on) */
  object_property_set_bool(OBJECT(gpio), "gpioB2", true, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioB3", false, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioB4", false, &error_fatal);
  object_property_set_bool(OBJECT(gpio), "gpioB5", false, &error_fatal);
}

static void aspeed_machine_fby4_class_init(ObjectClass *oc, const void *data) {
  MachineClass *mc = MACHINE_CLASS(oc);
  AspeedMachineClass *amc = ASPEED_MACHINE_CLASS(oc);

  mc->desc = "Facebook fby4 BMC (Cortex-A7)";
  mc->reset = fby4_reset;
  amc->fmc_model = "mx66l1g45g";
  amc->num_cs = 2;
  amc->macs_mask = ASPEED_MAC3_ON;
  amc->i2c_init = fby4_i2c_init;
  mc->default_ram_size = FBY4_BMC_RAM_SIZE;
  aspeed_machine_class_init_cpus_defaults(mc);
}

static const TypeInfo aspeed_ast2600_fby4_types[] = {
    {
        .name = MACHINE_TYPE_NAME("fby4-bmc"),
        .parent = MACHINE_TYPE_NAME("ast2600-evb"),
        .class_init = aspeed_machine_fby4_class_init,
        .interfaces = arm_machine_interfaces,
    }
};

DEFINE_TYPES(aspeed_ast2600_fby4_types)
